(function(o,r){typeof exports=="object"&&typeof module<"u"?module.exports=r(require("vue")):typeof define=="function"&&define.amd?define(["vue"],r):(o=typeof globalThis<"u"?globalThis:o||self,o["vue-input-highlighter"]=r(o.Vue))})(this,function(o){"use strict";const r="",_=["placeholder"],f="strong";return{__name:"input-highlighter",props:{modelValue:String,rules:{type:Array,default:[]},placeholder:{type:String,default:""}},emits:["update:modelValue","highlight","highlights"],setup(x,{emit:h}){const y=x,{modelValue:v,rules:H,placeholder:N}=o.toRefs(y),i=o.ref(""),u=o.ref(v.value),g=[];let c=[];for(const e of H.value)e instanceof RegExp?g.push({regex:e,class:"",style:"",tag:f}):e instanceof Object&&g.push({regex:e.regex,class:e.class?e.class:"",style:e.style?e.style:"",tag:e.tag?e.tag:f});o.onMounted(()=>{m()});const S=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),a=(e,t,n,l)=>{if(l.done)return l;let s=null;if(e.childNodes.length==0)l.pos+=e.textContent.length;else for(let d=0;d<e.childNodes.length&&!l.done;d++){if(s=e.childNodes[d],s===t)return l.pos+=n,l.done=!0,l;a(s,t,n,l)}return l},p=(e,t,n)=>{if(n.done)return t;if(e.childNodes.length==0)e.textContent.length>=n.pos?(t.setStart(e,n.pos),n.done=!0):n.pos=n.pos-e.textContent.length;else for(let l=0;l<e.childNodes.length&&!n.done;l++){let s=e.childNodes[l];p(s,t,n)}return t},C=e=>{for(const t of g)e=e.replaceAll(t.regex,`<${t.tag} class="${t.class}" style="${t.style}">$1</${t.tag}>`);return e},m=()=>{const e=S(u.value),t=C(e);i.value.innerHTML=t},A=e=>{const t=Array.from(e);return c.forEach(n=>{const l=t.indexOf(n);l>-1&&t.splice(l,1)}),t},E=()=>{const e=Array.from(i.value.children).map(t=>t.innerHTML);e.length>c.length&&h("highlight",A(e)),c=e,h("highlights",c)},R=()=>{u.value=i.value.textContent;const e=window.getSelection(),t=e.focusNode,n=e.focusOffset,l=a(i.value,t,n,{pos:0,done:!1});n===0&&(l.pos+=.5),m(),e.removeAllRanges();const s=p(i.value,document.createRange(),{pos:l.pos,done:!1});s.collapse(!0),e.addRange(s),E(),h("update:modelValue",u.value)};return(e,t)=>(o.openBlock(),o.createElementBlock("div",{contenteditable:"true",ref_key:"editableElmt",ref:i,class:"input-highlighter",placeholder:o.unref(N),onInput:R},null,40,_))}}});
